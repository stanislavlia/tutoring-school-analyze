"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —à–∫–æ–ª
–°–æ–∑–¥–∞–µ—Ç Excel —Ñ–∞–π–ª—ã —Å –æ—Ü–µ–Ω–∫–∞–º–∏ —É—á–µ–Ω–∏–∫–æ–≤ –ø–æ –≤—Å–µ–º —à–∫–æ–ª–∞–º –∏ –∫–ª–∞—Å—Å–∞–º
"""

import os
import random
import pandas as pd
import numpy as np
from pathlib import Path

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
SUBJECTS = ['–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', '–§–∏–∑–∏–∫–∞', '–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', '–ë–∏–æ–ª–æ–≥–∏—è']

SCHOOLS = [
    '–ú–ê–û–£ –°–û–® ‚Ññ1',
    '–ú–ê–û–£ –°–û–® ‚Ññ32',
    '–ú–ê–û–£ –°–û–® ‚Ññ24',
    '–ú–ê–û–£ –°–û–® ‚Ññ6',
    '–ú–ê–û–£ –°–û–® ‚Ññ11',
    '–ú–ê–û–£ –°–û–® ‚Ññ134',
    '–ú–ê–û–£ –°–û–® ‚Ññ2',
    '–ú–ê–û–£ –°–û–® ‚Ññ42',
    '–ú–ê–û–£ –°–û–® ‚Ññ9',
    '–ú–ê–û–£ –°–û–® ‚Ññ16',
    '–õ–∏—Ü–µ–π ‚Ññ7',
    '–õ–∏—Ü–µ–π ‚Ññ1'
    '–ì–∏–º–Ω–∞–∑–∏—è ‚Ññ9 –∏–º–µ–Ω–∏ –õ–µ—Ä–º–æ–Ω—Ç–æ–≤–∞'
]

# –ü—É–ª –∏–º–µ–Ω –∏ —Ñ–∞–º–∏–ª–∏–π
FIRST_NAMES_MALE = [
    '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä', '–î–º–∏—Ç—Ä–∏–π', '–ú–∞–∫—Å–∏–º', '–ê—Ä—Ç—ë–º', '–ò–≤–∞–Ω', '–î–∞–Ω–∏–∏–ª', '–ö–∏—Ä–∏–ª–ª',
    '–ê–Ω–¥—Ä–µ–π', '–ï–≥–æ—Ä', '–ù–∏–∫–∏—Ç–∞', '–ú–∏—Ö–∞–∏–ª', '–í–ª–∞–¥–∏—Å–ª–∞–≤', '–ì–µ–æ—Ä–≥–∏–π', '–†–æ–º–∞–Ω',
    '–¢–∏–º–æ—Ñ–µ–π', '–ú–∞—Ç–≤–µ–π', '–ò–ª—å—è', '–§—ë–¥–æ—Ä', '–î–µ–Ω–∏—Å', '–°–µ—Ä–≥–µ–π'
]

FIRST_NAMES_FEMALE = [
    '–ê–Ω–∞—Å—Ç–∞—Å–∏—è', '–ú–∞—Ä–∏—è', '–î–∞—Ä—å—è', '–ê–Ω–Ω–∞', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', '–ü–æ–ª–∏–Ω–∞', '–ê–ª–∏—Å–∞',
    '–í–∏–∫—Ç–æ—Ä–∏—è', '–ï–ª–∏–∑–∞–≤–µ—Ç–∞', '–ö—Å–µ–Ω–∏—è', '–°–æ—Ñ—å—è', '–í–∞—Ä–≤–∞—Ä–∞', '–ê—Ä–∏–Ω–∞', '–í–∞–ª–µ—Ä–∏—è',
    '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞', '–£–ª—å—è–Ω–∞', '–ú–∏–ª–∞–Ω–∞', '–ö—Ä–∏—Å—Ç–∏–Ω–∞', '–î–∏–∞–Ω–∞', '–í–µ—Ä–æ–Ω–∏–∫–∞'
]

LAST_NAMES = [
    '–ò–≤–∞–Ω–æ–≤', '–ü–µ—Ç—Ä–æ–≤', '–°–∏–¥–æ—Ä–æ–≤', '–°–º–∏—Ä–Ω–æ–≤', '–ö—É–∑–Ω–µ—Ü–æ–≤', '–ü–æ–ø–æ–≤', '–°–æ–∫–æ–ª–æ–≤',
    '–õ–µ–±–µ–¥–µ–≤', '–ö–æ–∑–ª–æ–≤', '–ù–æ–≤–∏–∫–æ–≤', '–ú–æ—Ä–æ–∑–æ–≤', '–í–æ–ª–∫–æ–≤', '–ê–ª–µ–∫—Å–µ–µ–≤', '–õ–µ–±–µ–¥–µ–≤',
    '–°–µ–º—ë–Ω–æ–≤', '–ï–≥–æ—Ä–æ–≤', '–ü–∞–≤–ª–æ–≤', '–ö–æ–∑–ª–æ–≤', '–°—Ç–µ–ø–∞–Ω–æ–≤', '–ù–∏–∫–æ–ª–∞–µ–≤', '–û—Ä–ª–æ–≤',
    '–ê–Ω–¥—Ä–µ–µ–≤', '–ú–∞–∫–∞—Ä–æ–≤', '–ù–∏–∫–∏—Ç–∏–Ω', '–ó–∞—Ö–∞—Ä–æ–≤', '–ó–∞–π—Ü–µ–≤', '–°–æ–ª–æ–≤—å—ë–≤', '–ë–æ—Ä–∏—Å–æ–≤',
    '–Ø–∫–æ–≤–ª–µ–≤', '–ì—Ä–∏–≥–æ—Ä—å–µ–≤', '–†–æ–º–∞–Ω–æ–≤', '–í–æ—Ä–æ–±—å—ë–≤', '–°–µ—Ä–≥–µ–µ–≤', '–§—ë–¥–æ—Ä–æ–≤', '–ú–∏—Ö–∞–π–ª–æ–≤'
]


def generate_full_name():
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ –§–ò–û"""
    gender = random.choice(['male', 'female'])
    
    if gender == 'male':
        first_name = random.choice(FIRST_NAMES_MALE)
        last_name = random.choice(LAST_NAMES)
        patronymic = random.choice(['–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á', '–î–º–∏—Ç—Ä–∏–µ–≤–∏—á', '–ò–≤–∞–Ω–æ–≤–∏—á', 
                                    '–°–µ—Ä–≥–µ–µ–≤–∏—á', '–ê–Ω–¥—Ä–µ–µ–≤–∏—á', '–ê–ª–µ–∫—Å–µ–µ–≤–∏—á',
                                    '–ú–∏—Ö–∞–π–ª–æ–≤–∏—á', '–í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á', '–ï–≤–≥–µ–Ω—å–µ–≤–∏—á'])
    else:
        first_name = random.choice(FIRST_NAMES_FEMALE)
        last_name = random.choice(LAST_NAMES) + '–∞'
        patronymic = random.choice(['–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞', '–î–º–∏—Ç—Ä–∏–µ–≤–Ω–∞', '–ò–≤–∞–Ω–æ–≤–Ω–∞',
                                    '–°–µ—Ä–≥–µ–µ–≤–Ω–∞', '–ê–Ω–¥—Ä–µ–µ–≤–Ω–∞', '–ê–ª–µ–∫—Å–µ–µ–≤–Ω–∞',
                                    '–ú–∏—Ö–∞–π–ª–æ–≤–Ω–∞', '–í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞', '–ï–≤–≥–µ–Ω—å–µ–≤–Ω–∞'])
    
    return f"{last_name} {first_name} {patronymic}"


def generate_grade(school_name):
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ü–µ–Ω–∫—É –ø–æ 100-–±–∞–ª–ª—å–Ω–æ–π —à–∫–∞–ª–µ –∏–∑ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    –î–ª—è –ª–∏—Ü–µ—è –∏ –≥–∏–º–Ω–∞–∑–∏–∏ - –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–µ –∏ –º–µ–Ω—å—à–µ –¥–∏—Å–ø–µ—Ä—Å–∏—è
    """
    if '–õ–∏—Ü–µ–π' in school_name or '–ì–∏–º–Ω–∞–∑–∏—è' in school_name:
        # –î–ª—è —ç–ª–∏—Ç–Ω—ã—Ö —à–∫–æ–ª
        mean = 83  # —Å—Ä–µ–¥–Ω–µ–µ –≤—ã—à–µ
        std = 10   # –º–µ–Ω—å—à–µ —Ä–∞–∑–±—Ä–æ—Å
    else:
        # –î–ª—è –æ–±—ã—á–Ω—ã—Ö —à–∫–æ–ª
        mean = 60  # —Å—Ä–µ–¥–Ω–µ–µ –Ω–∏–∂–µ
        std = 25   # –±–æ–ª—å—à–µ —Ä–∞–∑–±—Ä–æ—Å
    
    grade = np.random.normal(mean, std)
    # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω 0-100
    grade = max(0, min(100, grade))
    return round(grade)


def generate_class_data(school_name, class_name, num_students):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞"""
    students = []
    used_names = set()
    
    for _ in range(num_students):
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è
        while True:
            full_name = generate_full_name()
            if full_name not in used_names:
                used_names.add(full_name)
                break
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ü–µ–Ω–∫–∏
        student_data = {'–§–ò–û': full_name}
        for subject in SUBJECTS:
            student_data[subject] = generate_grade(school_name)
        
        students.append(student_data)
    
    return pd.DataFrame(students)


def create_school_structure():
    """–°–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è —à–∫–æ–ª—ã"""
    classes = []
    
    # 8-9 –∫–ª–∞—Å—Å—ã: –ø–æ 3-4 –±—É–∫–≤—ã
    for grade in [8, 9]:
        num_letters = random.randint(3, 4)
        letters = ['–ê', '–ë', '–í', '–ì'][:num_letters]
        for letter in letters:
            classes.append(f"{grade}{letter}")
    
    # 10-11 –∫–ª–∞—Å—Å—ã: –ø–æ 2 –±—É–∫–≤—ã
    for grade in [10, 11]:
        letters = ['–ê', '–ë']
        for letter in letters:
            classes.append(f"{grade}{letter}")
    
    return classes


def generate_all_data(output_dir='school_data'):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö —à–∫–æ–ª"""
    output_path = Path(output_dir)
    
    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –ø–∞–ø–∫—É –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if output_path.exists():
        import shutil
        shutil.rmtree(output_path)
    
    # –°–æ–∑–¥–∞–µ–º –≥–ª–∞–≤–Ω—É—é –ø–∞–ø–∫—É
    output_path.mkdir(exist_ok=True)
    
    print("üéì –ù–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö...\n")
    
    for school in SCHOOLS:
        # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è —à–∫–æ–ª—ã
        school_folder = output_path / school
        school_folder.mkdir(exist_ok=True)
        
        print(f"üìö {school}")
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª–∞—Å—Å—ã
        classes = create_school_structure()
        
        for class_name in classes:
            # –°–ª—É—á–∞–π–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–µ–Ω–∏–∫–æ–≤
            num_students = random.randint(15, 30)
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å–∞
            df = generate_class_data(school, class_name, num_students)
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Excel
            file_path = school_folder / f"{class_name}.xlsx"
            df.to_excel(file_path, index=False, engine='openpyxl')
            
            print(f"   ‚úì {class_name}: {num_students} —É—á–µ–Ω–∏–∫–æ–≤")
        
        print()
    
    print(f"‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ø–∞–ø–∫–µ '{output_dir}'")
    print(f"üìä –í—Å–µ–≥–æ —à–∫–æ–ª: {len(SCHOOLS)}")
    
    # –ü–æ–¥—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    total_files = sum(len(list(f.glob('*.xlsx'))) for f in output_path.iterdir() if f.is_dir())
    print(f"üìÅ –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ –∫–ª–∞—Å—Å–æ–≤: {total_files}")


if __name__ == '__main__':
    OUTPUT_DIR = "../data"
    generate_all_data()